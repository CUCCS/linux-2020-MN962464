### 第一章实验报告

**********

#### 软件环境

    1.Virtual box 中安装 ubuntu-18.04.4-Server版系统
    2.PuTTY操控虚拟机制作镜像

**********
#### 具体配置镜像操作：

+ 启动已经安装好的Ubuntu Server，检查是否是双网卡连接。
    ![](https://github.com/CUCCS/linux-2020-MN962464/edit/project1/chapter01/img/1.png)

    ---
+ 查看虚拟机的ssh服务是否打开
   ![](https://github.com/CUCCS/linux-2020-MN962464/edit/project1/chapter01/img/4.PNG)

    ---
+ 用putty连接虚拟机
    ![](https://github.com/CUCCS/linux-2020-MN962464/edit/project1/chapter01/img/6.PNG)

    ---
+ 用psftp将文件从主机传到虚拟机
   ![](https://github.com/CUCCS/linux-2020-MN962464/edit/project1/chapter01/img/5.PNG)

    ---
+ 回到putty登录的虚拟机命令行
    * 在当前用户目录下（/home/cuc）创建一个用于挂载iso镜像文件的目录
    >**mkdir loopdir**

    + 挂载iso镜像文件到该目录
    >**mount -o loop ubuntu-16.04.1-server-amd64.iso loopdir**

    + 创建一个工作目录用于克隆光盘内容
    >**mkdir cd**
 
    + 同步光盘内容到目标工作目录
    >**rsync -av loopdir/ cd
    ![](https://github.com/CUCCS/linux-2020-MN962464/edit/project1/chapter01/img/7.PNG)**

    + 编辑Ubuntu安装引导界面增加一个新菜单项入口
    >**vim isolinux/txt.cfg**

    + 添加以下内容到该文件后强制保存退出
    >label autoinstall
  menu label ^Auto Install Ubuntu Server
  kernel /install/vmlinuz
  append  file=/cdrom/preseed/ubuntu-server-autoinstall.seed debian-installer/locale=en_US console-setup/layoutcode=us keyboard-configuration/layoutcode=us console-setup/ask_detect=false localechooser/translation/warn-light=true localechooser/translation/warn-severe=true initrd=/install/initrd.gz root=/dev/ram rw quiet
    **编辑完后(:wq!)强制保存并退出**

    ---
+ 编辑老师的seed文件
将ipv4 example 中的几个ip地址改为自己电脑中的ip地址
  
  ---
+ 将seed文件传入刚才创建的工作目录
    (```/home/mmt/cd/preseed/ubuntu-server-autoinstall.seed```)
    ![](https://github.com/CUCCS/linux-2020-MN962464/edit/project1/chapter01/img/9.PNG)
    ```如果直接传入preseed目录，写入权限不够，所以先传输到/home/mmt/cd 路径下，再用sudo mv ubuntu-server-autoinstall.seed /home/mmt/cd/preseed/ 命令移动到presee目录下```
    ![](https://github.com/CUCCS/linux-2020-MN962464/edit/project1/chapter01/img/10.PNG)

    ---
+ 修改isolinux/isolinux.cfg，增加内容```timeout 10```
   ![](https://github.com/CUCCS/linux-2020-MN962464/edit/project1/chapter01/img/11.PNG)

    ---
+ 重新生成md5sum.txt
    ```sudo su -```
    ```cd /home/mmt/cd && find . -type f -print0 | xargs -0 md5sum > md5sum.txt```
    ![](https://github.com/CUCCS/linux-2020-MN962464/edit/project1/chapter01/img/12.PNG)

    ---
+  封闭改动后的目录到.iso
    ```IMAGE=1.iso```
    ```BUILD=/home/mmt/cd/```
    ```mkisofs -r -V "Custom Ubuntu Install CD" \-cache-inodes \-J -l -b isolinux/isolinux.bin \-c isolinux/boot.cat -no-emul-boot \-boot-load-size 4 -boot-info-table \-o $IMAGE $BUILD```
    ![](https://github.com/CUCCS/linux-2020-MN962464/edit/project1/chapter01/img/13.PNG)

---------
### 使用psftp将镜像拷贝到本地
![](https://github.com/CUCCS/linux-2020-MN962464/edit/project1/chapter01/img/16.PNG)

*********

### 无人值守安装
![](https://github.com/CUCCS/linux-2020-MN962464/edit/project1/chapter01/img/17.PNG)

    具体视频在仓库中可以看到，视频有无人值守安装的全部过程和登录过程。

------
### 实验过程中遇到的问题

+ PuTTY无法连接至虚拟机
    解决：查看sshd服务是否正常开启并关闭防火墙，发现都是正常的但还是连接超时
    ![](https://github.com/CUCCS/linux-2020-MN962464/edit/project1/chapter01/img/4.PNG)
    后来经过观察，发现我的虚拟机的ip地址和主机的前三位不同，觉得不对，又看了看自己的双网卡设置，将网卡一改为**桥接网络**，再查看ip地址，得到一个和主机前三位相同的地址，解决了PuTTY的连接问题
        ![](https://github.com/CUCCS/linux-2020-MN962464/edit/project1/chapter01/img/8.PNG)

    ----
+ 第一次修改txt.cfg文件时添加的内容未置顶，后来看了老师的提醒后又再次更改

    ----
+ 最后在向主机传文件时一直无法打开文件，查看权限是正常的,可读可写
    ![](https://github.com/CUCCS/linux-2020-MN962464/edit/project1/chapter01/img/14.PNG)
    又改了ssh的sshd_config文件，还是不行
    ![](https://github.com/CUCCS/linux-2020-MN962464/edit/project1/chapter01/img/15.PNG)
    后来又百度报错原因发现好像不能直接get到根目录下，于是换了个目录，解决了问题。

    -----

+ 第一次修改preseed文件修改了用户名和密码，密码太过简单导致安装过程中多了一步需要手动选择使用弱密码的过程，只能重新再做一次

    ---
+ md文件传到GitHub上图片无法正常显示，又对路径做了改动


--------
##### 如何用sftp传文件？
+ 直接用PuTTY时安装的自带的小兄弟psftp应用，在其中输入相关命令就可实现主机和虚拟机互传文件

-------

##### 关于新添加的网卡如何实现开机自动启用和获取ip地址
+ 我的两个网卡在设置里配置完后开机就是同时启用的状态，双网卡正常，使用ipconfig命令可以看到enp0s3和enp0s8的情况，但enp0s8的ip地址不是数字显示，个人认为未影响我的实验操作，就没更改。(并且在主机查看ipconfig可以看到虚拟机host-only网卡所分配的ip地址)
